---
# Configure tmux

- name: Clone TPM (Tmux Plugin Manager)
  git:
    repo: https://github.com/tmux-plugins/tpm
    dest: /home/ubuntu/.tmux/plugins/tpm
    version: master
  become_user: ubuntu

- name: Create tmux configuration
  copy:
    dest: /home/ubuntu/.tmux.conf
    owner: ubuntu
    group: ubuntu
    mode: '0644'
    content: |
      set-option default-terminal "tmux-256color"

      unbind r
      bind r source-file ~/.tmux.conf

      bind h split-window -v
      bind v split-window -h

      set -g mouse on

      # List of plugins
      set -g @plugin 'tmux-plugins/tpm'
      set -g @plugin 'tmux-plugins/tmux-sensible'
      set -g @plugin 'dracula/tmux'

      set -g @dracula-show-powerline true
      set -g @dracula-show-left-icon session

      set -g @dracula-show-flags true

      set -g @dracula-plugins "cpu-usage ram-usage time"
      set -g @dracula-military-time true

      # Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
      run '~/.tmux/plugins/tpm/tpm'

- name: Install tmux plugins
  shell: |
    /home/ubuntu/.tmux/plugins/tpm/scripts/install_plugins.sh
  become_user: ubuntu
  environment:
    TMUX_PLUGIN_MANAGER_PATH: /home/ubuntu/.tmux/plugins